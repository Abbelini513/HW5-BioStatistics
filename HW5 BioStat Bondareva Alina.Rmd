---
title: "HW5 BioStatistic"
author: "Bondareva Alina Kirillovna"
date: "2024-04-10"
output: html_document
---

```{=html}
<style type="text/css">
body{
  font-family: Helvetica;
  font-size: 12pt;
}
/* Headers */
h1, h2{
  font-size: 16pt;
}
</style>
```

# Домашнее задание №5.

## Выполнила Бондарева Алина Кирилловна

**Тема:** построение регрессионных моделей и анализ выживаемости.

**Цель:** научиться пользоваться основными методами регрессионного анализа, разобраться с принципами анализа выживаемости.

**Описание ДЗ**:
Для выполнения первых двух заданий мы будем использовать датасет *Breast Cancer Wisconsin*.
В колонке `diagnosis` содержится информация об опухоли (`M` = злокачественная, `B` = доброкачественная).

### **Задание 1**

*1. Создайте регрессионную модель, которая бы описывала связь среднего радиуса опухоли и средней площади (а), среднего периметра (б), средней симметричности (в).*

*2. Постройте графики, на которых отразите регрессионную прямую, и прокомментируйте свои находки.*

```{r, include=FALSE}
knitr::opts_chunk$set(
	message = FALSE,
	warning = FALSE,
	include = FALSE
)
library(ggplot2)
library(tidyverse)
library(car)
library(survival)
library(ggsurvfit)
library(survminer)
library(dplyr)

```

Сначала давайте загрузим и посмотрим наш датасет:
```{r, include=TRUE}
cancer <- read.csv("C:/Users/bonda/Desktop/МФТИ/2 семестр/Биостатистика/ДЗ5/wisconsin_breast_cancer.csv")

head(cancer)
str(cancer)
```
Нам нужно построить регрессионную модель, которая бы описывала связь **среднего радиуса опухоли** (`radius_mean`) и: 
* **средней площади** (`area_mean`);
* **среднего периметра** (`perimeter_mean`);
* **средней симметричности** (`symmetry_mean`).

Для этого давайте сначала проверим интересующие нас столбцы на пропущенные значения:
```{r, include=TRUE}
# Проверка пропущенных значений
colSums(is.na(cancer[c("radius_mean", "area_mean", "perimeter_mean", "symmetry_mean")]))
```
Мы видим, что пропущенных значений нет. Значит мы можем приступать к работе!

Выдвинем следующие гипотезы:

`Н0` - **Зависимая переменная и фактор не имеют статистически значимой зависимости;**
`H1` - **Зависимая переменная и фактор имеют статистически значимую зависимость.**

В медицинских исследованиях обычно используется уровень значимости $$\alpha = 0.05$$, что означает, что вероятность отклонить нулевую гипотезу, когда она верна, составляет 5%.

В данной ситуации оправдано использование линейной регрессии, так как все рассматриваемые переменные представлены в форме непрерывных числовых данных.

Построим первую линейную модель регрессии среднего радиуса опухоли и средней площади:

```{r, include=TRUE}
# Создание линейной регрессионной модели для среднего радиуса опухоли и средней площади
model1_area <- lm(radius_mean ~ area_mean, data = cancer)
summary(model1_area)
```
Интерпретация результатов модели1:

**Распределение остатков (Residuals)**

* `Минимальное значение остатков (Min)`: -4.9604, что показывает наибольшее отклонение предсказаний модели в сторону занижения.

* `Максимальное значение остатков (Max)`: 0.7788, указывающее на наибольшее отклонение предсказаний в сторону завышения.

* `Медиана остатков (Median)`: 0.1479, близка к нулю, что свидетельствует о том, что модель не имеет систематической ошибки в предсказаниях.

* `Интерквартильный размах(1Q-3Q)`: -0.1801 (1 квартиль) и 0.3600 (3 квартиль), эти значения отражают разброс остатков вокруг медианы, которые также указывают на равномерность и симметричность распределения остатков.

**Коэффициенты предикторов (Estimate)**

* `Coefficients Estimate area_mean` - *Изменение радиуса опухоли при увеличении средней площади на единицу*: На 0.009887. Это означает, что при увеличении средней площади опухоли на один квадратный миллиметр, средний радиус увеличивается примерно на 0.009887 миллиметра, что означает что есть минимальная положительная связь между этими двумя параметрами.

**Значение коэффициента интерсепта (Intercept)**

* `Coefficients Intercept` - *Значение радиуса опухоли при нулевом значении факторов*: 7.652 - это гипотетическое значение среднего радиуса, если средняя площадь была бы равна 0, что не имеет отношения реальности, но необходимо для математической формулировки модели.

**Статистическая значимость**

* `P-value` для обоих коэффициентов (<2e-16): Указывает на то, что связь между средним радиусом и средней площадью статистически значима.

**Общая статистика модели**

* `F-статистика`: 2.2e+04, что в сочетании с `p-value` модели (<2.2e-16) подчеркивает, что модель в целом статистически значима.

* `Residual standart error` - *Остаточная стандартная ошибка*: 0.5591, что относительно низко и говорит о хорошем качестве подгонки модели.

* `Adjusted R-squared` - *Скорректированный коэффициент детерминации*: 0.9748, показывает, что модель объясняет 97.48% вариации среднего радиуса опухоли. Это указывает на высокую предсказательную способность модели, хотя и это может быть признаком переобучения.

Данная модель показывает, что **средняя площадь `area_mean` опухоли является важным предиктором среднего радиуса опухоли `radius_mean`**, с высокой степенью статистической значимости и предсказательной способностью. Однако, важно проверить выполнение основных предположений линейной регрессии, включая нормальность распределения остатков и гомоскедастичность, что мы дальше и сделаем.

Проведем сначала визуальную оценку линейной зависимости переменной и одного из наших факторов:
```{r, include=TRUE}
# Визуальная оценка линейности зависимости 
ggplot(cancer, aes(x = area_mean, y = radius_mean)) +
geom_point() +
labs(title = "Зависимость среднего радиуса и средней площади опухоли",
    x = "Средняя площадь опухоли `area_mean`",
    y = "Средний радиус опухоли `radius_mean`") +
geom_smooth(method = "lm")
```
На графике видно, что факторы имеют линейную зависимость с перемененной радиуса опхуоли. 

Проверим теперь нормальность распределения остатков.
```{r, include=TRUE}
# Визуальная оценка нормальности распределения остатков
qqnorm(residuals(model1_area))
qqline(residuals(model1_area), col = "red")
```
```{r, include=TRUE}
# Оценка нормальности распределения остатков с помощью теста Шапиро-Уилка
shapiro.test(residuals(model1_area))
```
На графике Q_Q Plot точки (остатки) демонстрируют незначительные отклонения и, можно сказать, укладываются в заданные границы, в то время как в левой части графика наблюдаются значительные отклонения от линии. 

Тест Шапиро-Уилка также показывает нам не нормальное распределение остатков, поскольку `p-value` значительно меньше $$\alpha=0.05$$ (p-value < 2.2e-16). Это означает, что нулевую гипотезу о нормальности распределения остатков следует отвергнуть и принять альтернативную гипотезу.

Проверим еще гомоскедастичность остатков:
```{r, include=TRUE}
# Проверка гомоскедастически остатков
plot(model1_area, which = 1)
```
Мы видим явные признаки неоднородности в распределении остатков, проявляющиеся в том, что в одних частях графика точки сгущены, а в других их плотность заметно ниже. Это указывает на потенциальное нарушение предпосылки о гомоскедастичности, согласно которой дисперсии остатков должны быть одинаковыми на всех уровнях независимой переменно — можно сделать **вывод, что зависимость между рассматриваемыми переменными, возможно, не полностью линейна или что в модели могут быть неучтенные факторы, вызывающие изменчивость ошибок.** 

Теперь сделаем то же самое со средним периметром `perimeter_mean`
```{r, include=TRUE}
# Создание линейной регрессионной модели для среднего радиуса опухоли и среднего периметра опухли
model2_perimeter <- lm(radius_mean ~ perimeter_mean, data = cancer)
summary(model2_perimeter)
```
Интерпретация результатов модели2:

**Распределение остатков (Residuals)**

* `Минимальное значение остатков (Min)`: -1.43367, отражающее наибольшее отклонение предсказаний модели вниз.

* `Максимальное значение остатков (Max)`: 0.60550, показывающее максимальное отклонение предсказаний вверх.

* `Медиана остатков (Median)`: 0.02596, что является близким к нулю значением, указывающим на отсутствие систематической ошибки в предсказаниях модели.

* `Интерквартильный размах (1Q-3Q)`: -0.10445 (первый квартиль) и 0.14652 (третий квартиль), показывающие диапазон, в котором находится большинство остатков, указывая на относительную устойчивость модели.

**Коэффициенты предикторов (Estimate)**

* `Coefficients Estimate area_mean` - Изменение среднего радиуса опухоли при увеличении среднего периметра на единицу: На 0.1447176. Это указывает на сильную положительную связь между средним периметром и средним радиусом опухоли.

**Значение коэффициента интерсепта (Intercept)**

* `Coefficients Intercept` - Значение среднего радиуса опухоли при нулевом значении среднего периметра: 0.8177520. Хотя на практике средний периметр не может быть нулевым, это значение служит отправной точкой для предсказаний модели.

**Статистическая значимость**

* `P-value` для коэффициентов (<2e-16): Статистически значимая связь между средним радиусом и средним периметром опухоли.

**Общая статистика модели**

* `F-статистика`: 1.318e+05 на 1 и 567 степенях свободы, вместе с p-value (<2.2e-16) подтверждает статистическую значимость модели.

* `Residual standart error` - Остаточная стандартная ошибка: 0.2309, указывая на точность предсказаний модели.

* `Adjusted R-squared` - Скорректированный коэффициент детерминации: 0.9957, что означает, что модель объясняет 99.57% вариации среднего радиуса опухоли. Это свидетельствует о высокой предсказательной способности модели, но также поднимает вопросы о возможном переобучении.

Эта модель демонстрирует, что средний периметр опухоли является мощным предиктором среднего радиуса опухоли с высокой степенью статистической значимости и предсказательной способности.

```{r, include=TRUE}
# Визуальная оценка линейности зависимости 
ggplot(cancer, aes(x = perimeter_mean, y = radius_mean)) +
geom_point() +
labs(title = "Зависимость среднего радиуса и средней площади опухоли",
    x = "Средний периметр опухоли `perimeter_mean`",
    y = "Средний радиус опухоли `radius_mean`") +
geom_smooth(method = "lm")
```
На графике видно, что фактор имеет линейную зависимость с перемененной радиуса опхуоли.
Проверим теперь нормальность распределения остатков.

```{r, include=TRUE}
# Визуальная оценка нормальности распределения остатков
qqnorm(residuals(model2_perimeter))
qqline(residuals(model2_perimeter), col = "red")
```
Здесь мы видим похожую ситуацию с прошлым фактором средней площади опухоли, в левой части графика есть существенные отклонения остатков.
Проведем тест Шапиро-Уилка:

```{r, include=TRUE}
# Оценка нормальности распределения остатков с помощью теста Шапиро-Уилка
shapiro.test(residuals(model2_perimeter))
```
Тест Шапиро-Уилка также выявляет отсутствие нормальности в распределении остатков, так как p-value значительно меньше порогового уровня значимости $$\alpha=0.05$$ (p-value = 1.641e-14). Это указывает на то, что мы отвергаем нулевую гипотезу о нормальности распределения остатков и принимаем альтернативную гипотезу о том, что распределение остатков не соответствует нормальному распределению.

Проверим еще гомоскедастичность остатков:
```{r, include=TRUE}
# Проверка гомоскедастически остатков
plot(model2_perimeter, which = 1)
```
На данном графике точки кажутся более разбросанными по мере увеличения фитированных значений, что может указывать на потенциальную гетероскедастичность — изменение дисперсии остатков в зависимости от уровня предсказанных значений. Это наблюдение предполагает, что в модели могут быть неучтенные нелинейные связи или другие факторы, влияющие на изменчивость ошибок.

Теперь сделаем то же самое со средней семетричности `symmetry_mean`
```{r, include=TRUE}
# Создание линейной регрессионной модели для среднего радиуса опухоли и средней площади
model3_symmetry <- lm(radius_mean ~ symmetry_mean, data = cancer)
summary(model3_symmetry)
```
Интерпретация результатов модели3:

**Распределение остатков (Residuals)**

* `Минимальное значение остатков (Min)`: -7.3711, что указывает на значительное отклонение предсказаний модели вниз.

* `Максимальное значение остатков (Max)`: 14.2934, показывает сильное отклонение предсказаний вверх.

* `Медиана остатков (Median)`: -0.5862, демонстрирует небольшую наклонность распределения остатков в сторону отрицательных значений.

* `Интерквартильный размах (1Q-3Q)`: -2.4426 (первый квартиль) и 1.5744 (третий квартиль), обозначает широкий разброс остатков, что может свидетельствовать о потенциальной нестабильности модели.

**Коэффициенты предикторов (Estimate)**

* `Coefficients Estimate symmetry_mean` - Изменение среднего радиуса опухоли при увеличении среднего периметра на единицу: На 18.9918. Это показывает, что существует положительная связь между симметрией опухоли и средним радиусом опухоли, хотя основываясь на значении R-квадрата, эта связь может быть не столь сильной.

**Значение коэффициента интерсепта (Intercept)**

* `Coefficients Intercept` - Значение среднего радиуса опухоли при нулевом значении `symmetry_mean`: 10.6867. Это представляет собой ожидаемое значение среднего радиуса опухоли, когда средняя симметрия равна нулю.

**Статистическая значимость**

* `P-value` для коэффициента `symmetry_mean` (0.000406): Свидетельствует о статистически значимой связи между симметрией и средним радиусом опухоли, хотя сила связи может быть невелика.

**Общая статистика модели**

* `F-статистика`: 12.65 на 1 и 567 степенях свободы, показывает, что модель статистически значима.

* `Residual standart error` - Остаточная стандартная ошибка: 3.488, указывает на большую изменчивость остатков, что может влиять на точность предсказаний модели.

* `Adjusted R-squared` - Скорректированный коэффициент детерминации:  0.0201, показывает, что модель объясняет только около 2.01% вариации среднего радиуса опухоли, что свидетельствует о слабой предсказательной способности этой модели.

Эта модель показывает, что хотя средняя симметрия опухоли статистически значимо влияет на средний радиус, она объясняет лишь небольшую часть изменчивости радиуса опухоли. Это может указывать на необходимость поиска других, более мощных предикторов или на сложность взаимоотношений в данных, которые не могут быть адекватно описаны простой линейной моделью.

### **Задание 2**

*Пусть колонка с диагнозом принимает следующие значения: злокачественная опухоль — 1, а доброкачественная — 0. Постройте модель, которая бы прогнозировала вероятность возникновения злокачественной опухоли от:*
* *среднего радиуса* (`radius_mean`);
* *средней площади* (`area_mean`);
* *средней текстуры* (`texture_mean`).

*Постройте графики. Создайте модель, которая бы прогнозировала вероятность возникновения злокачественной опухоли от всех трех перечисленных факторов.*

Сначала нам необходимо заменить бинарные значения в колонке `diagnosis` на факториальные 1 - злокачественная опухль, 0 - доброкачественная опухль:

```{r, include=TRUE}
# Заменим значения в колонке diagnosis на бинарные значения 1 и 0
cancer$diagnosis <- ifelse(cancer$diagnosis == 'M', 1, 0)
```

Теперь мы можем построить модель логистической регрессии, которая будет прогнозировать вероятность возникновения опухли:
```{r,include=TRUE}
model4_diagnosis <- glm(diagnosis ~ radius_mean + area_mean + texture_mean, data = cancer, family = 'binomial')
summary(model4_diagnosis)
```
Интерпретация результатов модели4:

* **Предупреждение о том, что алгоритм не сошелся**, может указывать на проблемы с сходимостью модели, что часто бывает признаком плохо определенной модели или мультиколлинеарности среди предикторов.

**Коэффициенты предикторов (Estimate)**

* (`Intercept`): В модели логарифм отношения шансов наличия злокачественной опухоли при нулевых значениях всех предикторов отрицателен, что указывает на более высокую вероятность диагностирования злокачественной опухоли по сравнению с доброкачественной, если средний радиус, площадь и текстура равны нулю.

* (`Коэффициенты предикторов`): В данной модели изменение среднего радиуса и площади не оказывает статистически значимого влияния на вероятность диагностирования типа опухоли, как показывает их p-value, превышающее заданный уровень значимости alpha. Однако, фактор средней текстуры имеет `p-value` меньше alpha, что подразумевает статистическую значимость этого предиктора в модели.

* Остаточное отклонение (`Residual deviance`): Низкое остаточное отклонение в данной модели может свидетельствовать о том, что модель хорошо соответствует данным, однако предупреждение о недостаточной сходимости может указывать на противоположное.

* Нулевое отклонение (`Null deviance`): Высокое значение нулевого отклонения показывает различие между моделью только с интерсептом и полной моделью, но без учета предупреждения о недостаточной сходимости модели эти значения могут быть неверно интерпретированы.

**Общий вывод:** модель не показывает убедительной статистической значимости для всех предикторов, кроме среднего значения текстуры. Следовательно, необходимо дополнительно оценить модель, ее предикторы и рассмотреть возможные проблемы с сходимостью алгоритма для обеспечения надежных результатов.

Чтобы улучшить понимание влияния предикторов в моей модели логистической регрессии, следует экспоненцировать коэффициенты модели:
```{r, include=TRUE}
exp(coefficients(model4_diagnosis))
```
После этого преобразования коэффициентов (и учитывая статистическую значимость), мы можем сделать вывод, что фактор средней текстуры опухоли некоторым обрвзом увеличивает шансы на диагностику злокачественной опухоли в по сравнению с доброкачественной. Влияние других факторов, таких как средний радиус и площадь, на диагноз оказалось статистически не значимыми.

В контексте этой задачи проверка предположений логистической регрессии, таких как отсутствие мультиколлинеарности между предикторами, линейность связи между предикторами и логарифмом шансов, а также исключение экстремальных выбросов, не проводилась, так как это не было в условии задачи.

```{r, include=TRUE}
# Визуализация кривой логистической регрессии 
ggplot(cancer, aes(x = radius_mean, y = diagnosis)) +
geom_point() +
  labs(title = "Зависимость типа опухоли и сренего радиуса опухоли",
    x = "Средний радиус опухоли",
    y = "Тип опухоли") +
  geom_smooth(method = "glm", 
              method.args = list(family = "binomial")) +
theme_bw()
```
```{r, include=TRUE}
ggplot(cancer, aes(x = area_mean, y = diagnosis)) +
geom_point() +
  labs(title = "Зависимость типа опухоли и среней площади опухоли",
    x = "Средняя площадь опухоли",
    y = "Тип опухоли") +
  geom_smooth(method = "glm", 
              method.args = list(family = "binomial")) +
theme_bw()
```
```{r, include=TRUE}
ggplot(cancer, aes(x = texture_mean, y = diagnosis)) +
geom_point() +
  labs(title = "Зависимость типа опухоли и сренего значения текстуры опухоли",
    x = "Средняя текстура опухоли",
    y = "Тип опухоли") +
  geom_smooth(method = "glm", 
              method.args = list(family = "binomial")) +
theme_bw()
```
Теперь построим логистическую регрессионную модель, отражающую прогноз вероятности возникновения злокачественной опухоли от всех трех перечисленных факторов при их взаимодействии:

```{r}
model5_diagnosis <- glm(diagnosis ~ radius_mean * area_mean * texture_mean,
      data = cancer,
      family = "binomial")

summary(model5_diagnosis)
```
По результатам логистической регрессии с взаимодействием всех 3 факторов, мы видим, что все взаимодействия статистически не значимы, так как `p-value > alpha`.

### **Задание 3**

Для выполнения этого задания вам понадобится датасет `lung`, который встроен в пакет `survival`. 

Датасет содержит следующий набор переменных:

* `inst`: код учреждения;
* `time`: время выживаемости в днях;
* `status`: 1 = цензурирование, 2 = смерть;
* `age`: возраст в годах;
* `sex`: мужской = 1, женский = 2;
* `ph.ecog`: шкала опросника ECOG (оценку проводит врач). 0 = отсутствие симптомов, 1= симптомы есть, но пациент наблюдается амбулаторно, 2 = меньше половины дня пациент вынужден проводить в постели, 3 = больше половины дня нуждается в отдыхе лежа, но не прикован к постели, 4 = прикован к постели;
* `ph.karno`: шкала Карновского (от 0 до 100, от худшего к лучшему) по оценке врача;
* `pat.karno`: шкала Карновского (от 0 до 100, от худшего к лучшему) по оценке пациента;
* `meal.cal`: калории потребляемой пищи;
* `wt.loss`: потеря веса за последние полгода.

1. Создайте переменную `event`, в которой отразите наличие или отсутствие (1 или 0) интересующего события — смерти пациента.

2. Изучите работу функций `Surv()`, `survfit()` и `ggsurvplot()`:
2.1. Постройте кривые выживаемости в зависимости от пола (на одном графике должны получиться две кривые для каждого пола и таблица числа пациентов, подверженных риску (at risk) под ним). Поясните получившееся значение p-value для лог-рангового теста и опишите наблюдаемые результаты.
2.2. Постройте график кумулятивной функции рисков (**cumulative hazard function**) для пола. Проинтерпретируйте график.

2.3. С помощью функции `coxph()` постройте регрессию Кокса и оцените влияние пола на выживаемость. Что вы можете сказать о полученных результатах?
 
 
Сначала инициализируем датасет из пакета:
```{r,include=TRUE}
data_lung <- survival::lung
head(lung)
```
Создадим переменную `event`, в которой отразите наличие или отсутствие (1 или 0) интересующего события — смерти пациента:

```{r, include=TRUE}
lung$event <- ifelse(lung$status == 2,1,0)
head(lung)
```
Создадим выборку только тех пациентов, которые умерли - достигли целевого события:
```{r, include=TRUE}
data1_lung <- filter(data_lung,lung$event == 1)
head(data1_lung)
```
Изучим работу функций Surv(), survfit() и ggsurvplot():

Построим кривые выживаемости в зависимости от пола (на одном графике должны получиться две кривые для каждого пола и таблица числа пациентов, подверженных риску (at risk) под ним). 

```{r, include=TRUE}
# График кривых выживаемости в зависимости от пола
survfit_func <- survfit(Surv(time, status) ~ sex, data = data1_lung)

ggsurvplot(survfit_func, conf.int = TRUE, surv.median.line = 'hv', risk.table = TRUE)
```
График показывает процент выживших пациентов в течение времени. Доверительные интервалы для мужчин и женщин перекрываются, и кривые выживаемости пересекаются, что может указывать на отсутствие значительных различий в выживаемости между полами.

Установим порог статистической значимости alpha в 0.05, как и раньше, и выдвинем следующие гипотезы:

* `Н0` - нет разницы в выживаемости между группами полов.

* `Н1` - разница в выживаемости между полами есть.

Попробуем провести Лонг-ранг тест,  который проводится для сравнения кривых выживаемости между различными группами, в данном случае, между мужчинами и женщинами. Лог-ранг тест позволяет оценить, есть ли статистически значимые различия в выживаемости пациентов этих двух групп.
```{r, include=TRUE}
# Лог-ранг тест
survdiff(Surv(time, status) ~ sex, data = data1_lung)
```
Интерпретация Лонг-ранг теста:

* `N`: Количество участников в каждой группе (112 участников с sex=1 и 53 участника с sex=2).

* `Observed` **(Наблюдаемые случаи)**: Количество фактических событий (например, смертей) в каждой группе.

* `Expected` **(Ожидаемые случаи)**: Количество событий, которые ожидались в каждой группе на основе предположения, что нет различий в выживаемости между группами.

* `(O-E)^2/E`: Статистика, показывающая отношение квадрата разности между наблюдаемыми и ожидаемыми случаями к ожидаемым случаям. Это мера того, насколько наблюдаемые данные отличаются от ожидаемых.

* `(O-E)^2/V`: Статистика, используемая в качестве основы для вычисления хи-квадрат статистики, где V - дисперсия.

* **Хи-квадрат статистика** (`Chisq`= 2.2) с 1 степенью свободы и p-значение 0.1 указывает на то, что на уровне значимости 0.1 различия в выживаемости между двумя группами, разделенными по полу, статистически не значимы. Это означает, что нет достаточных доказательств для отклонения нулевой гипотезы о том, что выживаемость одинакова для обеих групп, при данном уровне значимости.

В контексте задачи это может означать, что пол не имеет значимого влияния на выживаемость пациентов с раком легких в данной выборке.

Теперь построим график кумулятивной функции рисков (`cumulative hazard function`) для пола и проинтерпретируем его.

```{r, include=TRUE}
# График кумулятивной функции рисков по полу
ggsurvplot(survfit_func, fun = "cumhaz", conf.int = TRUE, risk.table = TRUE)
```
График кумулятивной функции рисков демонстрирует изменение вероятности наступления события со временем. По горизонтальной оси указано время, по вертикальной — кумулятивный риск.

Из графика видно, что доверительные интервалы для обеих групп частично перекрываются, а их кривые риска в некоторых точках пересекаются. Это указывает на то, что различия в риске между мужчинами и женщинами статистически не значимы.

А теперь с помощью функции `coxph()` построим регрессию Кокса и оценим влияние пола на выживаемость:

```{r}
# Регрессия Кокса
cox <- coxph(Surv(time, status) ~ sex, data = data1_lung)
summary(cox)
```
Результаты регрессии Кокса для данных о раке легких с предиктором пол (`sex`) предоставляют следующую информацию:

* **Количество наблюдений (`n`):** 165, с таким же количеством событий (смертей).

* **Коэффициент (coef) для пола (sex)**: -0.2511, что указывает на то, что риск события (в данном случае, смерти) для одного из полов ниже по сравнению с другим. Поскольку пол кодировался как бинарная переменная, это значение говорит о снижении риска для одной группы по сравнению с другой.

* **Экспоненцированный коэффициент (exp(coef)) или отношение рисков (hazard ratio, HR):** 0.7779. Это значит, что риск события для группы, обозначенной как `sex=1`, на 22.21% ниже, чем для группы `sex=0`.

* **P-value для пола**: 0.136, что означает отсутствие статистически значимого различия между полами по уровню риска, так как p-value больше установленного порога статистической значимости $$\alpha$$.

* **Доверительный интервал для HR:** Охватывает диапазон от 0.5594 до 1.082, что также подтверждает вывод о статистической незначимости различий между группами.

Общие выводы из результатов регрессии Кокса:

Полученное значение `p-value = 0.136` указывает на то, что различия между группами по полу не являются статистически значимыми, поскольку p-value превышает порог значимости alpha. Также по величине коэффициента (coef) и его экспоненты (exp(coef)) видно, что уровень относительного риска (exp(coef) = 0.7779) между двумя группами не достигает статистической значимости, что подтверждает вывод о отсутствии значимого влияния пола на выживаемость в данной выборке данных о раке легких.


